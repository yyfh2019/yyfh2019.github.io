<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>CYNçŸ­é“¾æœåŠ¡</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        :root { --primary: #2196F3; --error: #f44336; }
        body { font-family: 'Segoe UI', sans-serif; max-width: 800px; margin: 2rem auto; padding: 0 1rem; }
        .container { background: #f8f9fa; border-radius: 10px; padding: 2rem; box-shadow: 0 2px 15px rgba(0,0,0,0.1); }
        h1 { color: var(--primary); margin-bottom: 1.5rem; text-align: center; }
        .input-group { display: flex; gap: 1rem; margin-bottom: 1.5rem; }
        input { flex: 1; padding: 0.8rem; border: 2px solid #ddd; border-radius: 5px; font-size: 1rem; }
        button { background: var(--primary); color: white; border: none; padding: 0.8rem 2rem; border-radius: 5px; cursor: pointer; transition: opacity 0.3s; }
        button:hover { opacity: 0.9; }
        .result { background: white; padding: 1rem; border-radius: 5px; margin-top: 1rem; word-break: break-all; }
        .error { color: var(--error); padding: 1rem; display: none; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”— CYN çŸ­é“¾ç”ŸæˆæœåŠ¡</h1>
        <div class="input-group">
            <input type="url" id="inputUrl" placeholder="è¯·è¾“å…¥éœ€è¦ç¼©çŸ­çš„é•¿é“¾æ¥">
            <button onclick="generate()">ç”ŸæˆçŸ­é“¾</button>
        </div>
        <div class="error" id="errorMsg"></div>
        <div class="result" id="result"></div>
    </div>

    <script>
        // é…ç½®å‚æ•°
        const CONFIG = {
            SECRET_TOKEN: 'cc77fb8efb04a0ba445772fa03083f16',
            SERVICE_TYPE: 'cyn',
            DOMAIN: 'https://yyfh2019.github.io'
        };

        // è‡ªåŠ¨å¤„ç†çŸ­é“¾æ¥è¯·æ±‚
        (function init() {
            const params = new URLSearchParams(window.location.search);
            
            if (params.has('type') && params.has('token') && params.has('url')) {
                if (params.get('type') === CONFIG.SERVICE_TYPE && 
                    params.get('token') === CONFIG.SECRET_TOKEN) {
                    const targetUrl = decodeURIComponent(params.get('url'));
                    if (isValidUrl(targetUrl)) {
                        window.location.href = targetUrl;
                        return;
                    }
                }
                showError('æ— æ•ˆçš„çŸ­é“¾æ¥æˆ–ä»¤ç‰Œå·²è¿‡æœŸ');
            }
        })();

        // ç”ŸæˆçŸ­é“¾æ¥
        function generate() {
            const input = document.getElementById('inputUrl').value.trim();
            const error = document.getElementById('errorMsg');
            
            if (!isValidUrl(input)) {
                showError('è¯·è¾“å…¥æœ‰æ•ˆçš„URLåœ°å€ï¼ˆéœ€åŒ…å«http://æˆ–https://ï¼‰');
                return;
            }

            const shortUrl = `${CONFIG.DOMAIN}/?type=${CONFIG.SERVICE_TYPE}&token=${CONFIG.SECRET_TOKEN}&url=${encodeURIComponent(input)}`;
            
            document.getElementById('result').innerHTML = `
                <p>âœ… ç”ŸæˆæˆåŠŸï¼ç«‹å³æµ‹è¯•ï¼š</p>
                <input value="${shortUrl}" readonly 
                       style="width:100%; padding:0.5rem; margin:0.5rem 0;">
                <button onclick="copyUrl()">å¤åˆ¶é“¾æ¥</button>
                <button onclick="testRedirect()">æµ‹è¯•è·³è½¬</button>
            `;
        }

        // è¾…åŠ©å‡½æ•°
        function isValidUrl(url) {
            try {
                new URL(url);
                return /^https?:/.test(url);
            } catch {
                return false;
            }
        }

        function showError(msg) {
            const error = document.getElementById('errorMsg');
            error.textContent = msg;
            error.style.display = 'block';
            setTimeout(() => error.style.display = 'none', 3000);
        }

        function copyUrl() {
            navigator.clipboard.writeText(document.querySelector('#result input').value)
                .then(() => alert('å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼'))
                .catch(() => showError('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨é€‰æ‹©å¤åˆ¶'));
        }

        function testRedirect() {
            window.open(document.querySelector('#result input').value, '_blank');
        }
    </script>
</body>
</html>
